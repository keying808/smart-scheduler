<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ—¥ç¨‹ç®¡ç†å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .input-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .input-area {
            margin-bottom: 20px;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-input-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .file-input-area.dragover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .calendar-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .calendar-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e0e0;
        }

        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 10px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .calendar-day:hover {
            background: #f8f9ff;
        }

        .calendar-day.other-month {
            background: #f5f5f5;
            color: #999;
        }

        .calendar-day.today {
            background: #fff3e0;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event {
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
        }

        .event:hover {
            transform: scale(1.02);
        }

        .event.study {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .event.work {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .event.personal {
            background: linear-gradient(135deg, #55a3ff, #3742fa);
        }

        .event.other {
            background: linear-gradient(135deg, #26de81, #20bf6b);
        }

        .event.completed {
            opacity: 0.5;
            text-decoration: line-through;
            background: linear-gradient(135deg, #b2bec3, #636e72) !important;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .event-details {
            line-height: 1.6;
        }

        .event-details h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .event-details .field {
            margin-bottom: 15px;
        }

        .event-details .field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .event-details .field input,
        .event-details .field select,
        .event-details .field textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .event-details .field textarea {
            resize: vertical;
            min-height: 60px;
        }

        .event-details .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .event-details .links {
            margin-top: 15px;
        }

        .event-details .links a {
            color: #667eea;
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
        }

        .event-details .links a:hover {
            text-decoration: underline;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #00b894;
            color: white;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .error {
            color: #ff6b6b;
            background: #ffe0e0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .success {
            color: #00b894;
            background: #e0f7e9;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .day-events-modal .modal-content {
            max-width: 600px;
        }

        .day-events-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .day-event-item {
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .day-event-item:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }

        .day-event-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .day-event-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .day-event-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .day-event-category {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            display: inline-block;
        }

        .day-event-category.study {
            background: #74b9ff;
        }

        .day-event-category.work {
            background: #fd79a8;
        }

        .day-event-category.personal {
            background: #55a3ff;
        }

        .day-event-category.other {
            background: #26de81;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 5px;
            }
            
            .input-section {
                padding: 15px;
            }

            .event-details .time-inputs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // å¢å¼ºçš„æ™ºèƒ½æ–‡æœ¬è§£æå‡½æ•°
        const parseTaskText = (text) => {
            const task = {
                title: '',
                description: text,
                dueDate: null,
                startTime: null,
                endTime: null,
                category: 'other',
                links: [],
                details: ''
            };

            // æå–é“¾æ¥
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const links = text.match(urlRegex) || [];
            task.links = links;

            // ç§»é™¤é“¾æ¥åçš„æ–‡æœ¬
            const textWithoutLinks = text.replace(urlRegex, '').trim();

            // æ—¶é—´è§£æ - æ”¯æŒå¤šç§æ ¼å¼
            const now = new Date();
            let foundDate = null;
            let foundStartTime = null;
            let foundEndTime = null;

            // 1. ç›¸å¯¹æ—¶é—´æ¨¡å¼
            const relativeTimePatterns = [
                { pattern: /ä»Šå¤©|today/i, days: 0 },
                { pattern: /æ˜å¤©|tomorrow/i, days: 1 },
                { pattern: /åå¤©/i, days: 2 },
                { pattern: /å¤§åå¤©/i, days: 3 },
                { pattern: /ä¸‹å‘¨ä¸€|next monday/i, days: getDaysUntilWeekday(1) },
                { pattern: /ä¸‹å‘¨äºŒ|next tuesday/i, days: getDaysUntilWeekday(2) },
                { pattern: /ä¸‹å‘¨ä¸‰|next wednesday/i, days: getDaysUntilWeekday(3) },
                { pattern: /ä¸‹å‘¨å››|next thursday/i, days: getDaysUntilWeekday(4) },
                { pattern: /ä¸‹å‘¨äº”|next friday/i, days: getDaysUntilWeekday(5) },
                { pattern: /ä¸‹å‘¨å…­|next saturday/i, days: getDaysUntilWeekday(6) },
                { pattern: /ä¸‹å‘¨æ—¥|ä¸‹å‘¨å¤©|next sunday/i, days: getDaysUntilWeekday(0) },
                { pattern: /(\d+)å¤©å/, days: (match) => parseInt(match[1]) },
                { pattern: /ä¸€å‘¨å|next week/i, days: 7 },
                { pattern: /ä¸¤å‘¨å/i, days: 14 }
            ];

            // 2. ç»å¯¹æ—¶é—´æ¨¡å¼ - æ”¯æŒæ›´å¤šæ ¼å¼
            const absoluteTimePatterns = [
                // æ”¯æŒ 8.14, 8/14, 8-14 ç­‰æ ¼å¼
                { pattern: /(\d{1,2})[\.\/\-](\d{1,2})(?:[\.\/\-](\d{2,4}))?/, type: 'mdy' },
                // æ”¯æŒä¼ ç»Ÿæ ¼å¼ï¼š3æœˆ15æ—¥
                { pattern: /(\d{1,2})æœˆ(\d{1,2})[æ—¥å·]?/, type: 'chinese' },
                // æ”¯æŒå®Œæ•´æ—¥æœŸæ ¼å¼
                { pattern: /(\d{4})[å¹´\-\/](\d{1,2})[æœˆ\-\/](\d{1,2})[æ—¥å·]?/, type: 'full' }
            ];

            // 3. æ—¶é—´æ¨¡å¼ - è¯†åˆ«å…·ä½“å°æ—¶
            const timePatterns = [
                // ä¸Šåˆ9ç‚¹, ä¸‹åˆ2ç‚¹
                { pattern: /ä¸Šåˆ(\d{1,2})[ç‚¹æ—¶]?/, modifier: 'am' },
                { pattern: /ä¸‹åˆ(\d{1,2})[ç‚¹æ—¶]?/, modifier: 'pm' },
                // 9:30, 14:30
                { pattern: /(\d{1,2}):(\d{1,2})/, modifier: 'time' },
                // 9ç‚¹, 14ç‚¹
                { pattern: /(\d{1,2})[ç‚¹æ—¶]/, modifier: 'hour' },
                // æ—¶é—´èŒƒå›´ï¼š9-11ç‚¹, 2ç‚¹åˆ°4ç‚¹
                { pattern: /(\d{1,2})[ç‚¹æ—¶]?[-åˆ°è‡³](\d{1,2})[ç‚¹æ—¶]/, modifier: 'range' },
                { pattern: /(\d{1,2}):(\d{1,2})[-åˆ°è‡³](\d{1,2}):(\d{1,2})/, modifier: 'timeRange' }
            ];

            // å°è¯•è§£æç›¸å¯¹æ—¶é—´
            for (let pattern of relativeTimePatterns) {
                const match = textWithoutLinks.match(pattern.pattern);
                if (match) {
                    const days = typeof pattern.days === 'function' 
                        ? pattern.days(match) 
                        : pattern.days;
                    foundDate = new Date(now);
                    foundDate.setDate(now.getDate() + days);
                    break;
                }
            }

            // å°è¯•è§£æç»å¯¹æ—¶é—´
            if (!foundDate) {
                for (let pattern of absoluteTimePatterns) {
                    const match = textWithoutLinks.match(pattern.pattern);
                    if (match) {
                        let year = now.getFullYear();
                        let month, day;

                        switch (pattern.type) {
                            case 'mdy':
                                month = parseInt(match[1]);
                                day = parseInt(match[2]);
                                if (match[3]) {
                                    year = parseInt(match[3]);
                                    if (year < 100) year += 2000; // å¤„ç†ä¸¤ä½å¹´ä»½
                                }
                                break;
                            case 'chinese':
                                month = parseInt(match[1]);
                                day = parseInt(match[2]);
                                break;
                            case 'full':
                                year = parseInt(match[1]);
                                month = parseInt(match[2]);
                                day = parseInt(match[3]);
                                break;
                        }
                        
                        if (month && day && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                            const testDate = new Date(year, month - 1, day);
                            // å¦‚æœæ˜¯ä»Šå¹´çš„æ—¥æœŸæˆ–æœªæ¥æ—¥æœŸï¼Œåˆ™é‡‡ç”¨
                            if (testDate >= new Date(now.getFullYear(), 0, 1)) {
                                foundDate = testDate;
                                break;
                            }
                        }
                    }
                }
            }

            // è§£ææ—¶é—´
            for (let pattern of timePatterns) {
                const match = textWithoutLinks.match(pattern.pattern);
                if (match) {
                    switch (pattern.modifier) {
                        case 'am':
                            foundStartTime = `${String(parseInt(match[1])).padStart(2, '0')}:00`;
                            break;
                        case 'pm':
                            let hour = parseInt(match[1]);
                            if (hour !== 12) hour += 12;
                            foundStartTime = `${String(hour).padStart(2, '0')}:00`;
                            break;
                        case 'time':
                            foundStartTime = `${String(parseInt(match[1])).padStart(2, '0')}:${String(parseInt(match[2])).padStart(2, '0')}`;
                            break;
                        case 'hour':
                            let h = parseInt(match[1]);
                            foundStartTime = `${String(h).padStart(2, '0')}:00`;
                            break;
                        case 'range':
                            let startH = parseInt(match[1]);
                            let endH = parseInt(match[2]);
                            foundStartTime = `${String(startH).padStart(2, '0')}:00`;
                            foundEndTime = `${String(endH).padStart(2, '0')}:00`;
                            break;
                        case 'timeRange':
                            foundStartTime = `${String(parseInt(match[1])).padStart(2, '0')}:${String(parseInt(match[2])).padStart(2, '0')}`;
                            foundEndTime = `${String(parseInt(match[3])).padStart(2, '0')}:${String(parseInt(match[4])).padStart(2, '0')}`;
                            break;
                    }
                    break;
                }
            }

            // è®¾ç½®è§£æç»“æœ
            if (foundDate) {
                task.dueDate = foundDate;
            }
            if (foundStartTime) {
                task.startTime = foundStartTime;
            }
            if (foundEndTime) {
                task.endTime = foundEndTime;
            }

            // åˆ†ç±»åˆ¤æ–­
            const categoryKeywords = {
                study: /ä½œä¸š|homework|è€ƒè¯•|exam|ä¸Šè¯¾|class|è¯¾ç¨‹|course|å­¦ä¹ |study|assignment|è®ºæ–‡|paper|å®éªŒ|lab|é¢„ä¹ |å¤ä¹ |quiz|æµ‹éªŒ|è®²åº§|lecture/i,
                work: /å·¥ä½œ|work|ä¼šè®®|meeting|é¡¹ç›®|project|ä»»åŠ¡|task|ç®€å†|resume|æŠ•é€’|apply|é¢è¯•|interview|æŠ¥å‘Š|report|å®¢æˆ·|client|åŠ ç­|overtime/i,
                personal: /çº¦ä¼š|date|èšä¼š|party|è´­ç‰©|shopping|ç”µè¯|call|é“¶è¡Œ|bank|åŠç†|handle|åŒ»é™¢|hospital|ä½“æ£€|checkup|ç”Ÿæ—¥|birthday|å¥èº«|gym|è¿åŠ¨|exercise/i
            };

            for (let [category, regex] of Object.entries(categoryKeywords)) {
                if (regex.test(textWithoutLinks)) {
                    task.category = category;
                    break;
                }
            }

            // æå–å¹²å‡€çš„æ ‡é¢˜
            let title = textWithoutLinks;
            
            // ç§»é™¤æ—¶é—´ç›¸å…³è¡¨è¾¾
            title = title.replace(/\d+å¤©å|ä»Šå¤©|æ˜å¤©|åå¤©|å¤§åå¤©|ä¸‹å‘¨[ä¸€äºŒä¸‰å››äº”å…­æ—¥å¤©]|ä¸€å‘¨å|ä¸¤å‘¨å|ä¸Šåˆ|ä¸‹åˆ|\d{1,2}[\.\/\-]\d{1,2}(?:[\.\/\-]\d{2,4})?|\d{1,2}æœˆ\d{1,2}[æ—¥å·]?|\d{4}[å¹´\-\/]\d{1,2}[æœˆ\-\/]\d{1,2}[æ—¥å·]?|\d{1,2}[ç‚¹æ—¶](\d{1,2}åˆ†?)?|\d{1,2}:\d{1,2}|\d{1,2}[ç‚¹æ—¶]?[-åˆ°è‡³]\d{1,2}[ç‚¹æ—¶]?/g, '');
            
            // ç§»é™¤å¸¸è§åŠ¨è¯å’Œè¿æ¥è¯
            title = title.replace(/å‰|è¦|éœ€è¦|è®°å¾—|åˆ«å¿˜äº†|å®Œæˆ|æäº¤|å‚åŠ |å»|åˆ°|åœ¨|å’Œ|ä¸|è·Ÿ|ç»™|ä¸ºäº†|å…³äº|çš„|äº†|æ˜¯|æœ‰|ä¼š|å°†|æŠŠ|è¢«|è®©|ä½¿|åš|è¿›è¡Œ/g, '');
            
            // æ¸…ç†å¤šä½™ç©ºç™½å¹¶æˆªå–åˆç†é•¿åº¦
            title = title.trim().replace(/\s+/g, ' ');
            if (title.length > 25) {
                title = title.substring(0, 25) + '...';
            }
            
            task.title = title || 'æ–°ä»»åŠ¡';
            task.details = textWithoutLinks;

            return task;
        };

        // è·å–åˆ°æŒ‡å®šæ˜ŸæœŸå‡ çš„å¤©æ•°
        function getDaysUntilWeekday(targetDay) {
            const today = new Date();
            const currentDay = today.getDay();
            const daysUntil = (targetDay - currentDay + 7) % 7;
            return daysUntil === 0 ? 7 : daysUntil;
        }

        // ä¸»åº”ç”¨ç»„ä»¶
        const App = () => {
            const [tasks, setTasks] = useState([]);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [inputText, setInputText] = useState('');
            const [activeTab, setActiveTab] = useState('text');
            const [selectedTask, setSelectedTask] = useState(null);
            const [selectedDayEvents, setSelectedDayEvents] = useState(null);
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState('');
            const [messageType, setMessageType] = useState('');

            // åŠ è½½ä¿å­˜çš„ä»»åŠ¡
            useEffect(() => {
                const savedTasks = localStorage.getItem('smartSchedulerTasks');
                if (savedTasks) {
                    const parsedTasks = JSON.parse(savedTasks).map(task => ({
                        ...task,
                        dueDate: task.dueDate ? new Date(task.dueDate) : null,
                        createdAt: new Date(task.createdAt)
                    }));
                    setTasks(parsedTasks);
                }
            }, []);

            // ä¿å­˜ä»»åŠ¡åˆ°localStorage
            useEffect(() => {
                if (tasks.length > 0) {
                    localStorage.setItem('smartSchedulerTasks', JSON.stringify(tasks));
                }
            }, [tasks]);

            // è®¾ç½®æé†’
            useEffect(() => {
                const checkReminders = () => {
                    const now = new Date();
                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    const threeDaysFromNow = new Date(today);
                    threeDaysFromNow.setDate(today.getDate() + 3);

                    tasks.forEach(task => {
                        if (!task.dueDate || task.completed) return;

                        const taskDate = new Date(task.dueDate.getFullYear(), task.dueDate.getMonth(), task.dueDate.getDate());
                        
                        if (taskDate.getTime() === today.getTime() && !task.todayReminded) {
                            showNotification(`ä»Šå¤©æˆªæ­¢: ${task.title}`, task.description);
                            task.todayReminded = true;
                        }
                        
                        if (taskDate.getTime() === threeDaysFromNow.getTime() && !task.threeDayReminded) {
                            showNotification(`3å¤©åæˆªæ­¢: ${task.title}`, task.description);
                            task.threeDayReminded = true;
                        }
                    });
                };

                const interval = setInterval(checkReminders, 60000);
                checkReminders();

                return () => clearInterval(interval);
            }, [tasks]);

            const showNotification = (title, body) => {
                if (Notification.permission === 'granted') {
                    new Notification(title, { body, icon: '/favicon.ico' });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification(title, { body, icon: '/favicon.ico' });
                        }
                    });
                }
            };

            const showMessage = (msg, type = 'success') => {
                setMessage(msg);
                setMessageType(type);
                setTimeout(() => {
                    setMessage('');
                    setMessageType('');
                }, 3000);
            };

            const handleTextSubmit = () => {
                if (!inputText.trim()) {
                    showMessage('è¯·è¾“å…¥ä»»åŠ¡å†…å®¹', 'error');
                    return;
                }

                setLoading(true);
                
                try {
                    const parsedTask = parseTaskText(inputText);
                    const newTask = {
                        ...parsedTask,
                        id: Date.now(),
                        completed: false,
                        createdAt: new Date(),
                        todayReminded: false,
                        threeDayReminded: false
                    };
                    
                    setTasks(prev => [...prev, newTask]);
                    setInputText('');
                    showMessage('ä»»åŠ¡æ·»åŠ æˆåŠŸï¼');
                } catch (error) {
                    showMessage('è§£æä»»åŠ¡æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleImageUpload = async (file) => {
                if (!file || !file.type.startsWith('image/')) {
                    showMessage('è¯·ä¸Šä¼ æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶', 'error');
                    return;
                }

                setLoading(true);
                
                try {
                    const { data: { text } } = await Tesseract.recognize(file, 'chi_sim+eng');
                    
                    if (text.trim()) {
                        const parsedTask = parseTaskText(text);
                        const newTask = {
                            ...parsedTask,
                            id: Date.now(),
                            completed: false,
                            createdAt: new Date(),
                            todayReminded: false,
                            threeDayReminded: false
                        };
                        
                        setTasks(prev => [...prev, newTask]);
                        showMessage('å›¾ç‰‡è§£ææˆåŠŸï¼Œä»»åŠ¡å·²æ·»åŠ ï¼');
                    } else {
                        showMessage('æœªèƒ½ä»å›¾ç‰‡ä¸­è¯†åˆ«å‡ºæ–‡å­—ï¼Œè¯·é‡è¯•', 'error');
                    }
                } catch (error) {
                    showMessage('å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const file = e.dataTransfer.files[0];
                if (file) {
                    handleImageUpload(file);
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const navigateMonth = (direction) => {
                setCurrentDate(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(prev.getMonth() + direction);
                    return newDate;
                });
            };

            const toggleTaskComplete = (taskId) => {
                setTasks(prev => prev.map(task => 
                    task.id === taskId ? { ...task, completed: !task.completed } : task
                ));
                showMessage(
                    tasks.find(t => t.id === taskId)?.completed ? 'ä»»åŠ¡æ ‡è®°ä¸ºæœªå®Œæˆ' : 'ä»»åŠ¡å·²å®Œæˆï¼'
                );
            };

            const updateTask = (taskId, updates) => {
                setTasks(prev => prev.map(task => 
                    task.id === taskId ? { ...task, ...updates } : task
                ));
                showMessage('ä»»åŠ¡æ›´æ–°æˆåŠŸ');
            };

            const deleteTask = (taskId) => {
                setTasks(prev => prev.filter(task => task.id !== taskId));
                setSelectedTask(null);
                showMessage('ä»»åŠ¡å·²åˆ é™¤');
            };

            const handleDayClick = (year, month, day) => {
                const clickedDate = new Date(year, month, day);
                const dayTasks = tasks.filter(task => {
                    if (!task.dueDate) return false;
                    const taskDate = new Date(task.dueDate);
                    return taskDate.getFullYear() === year &&
                           taskDate.getMonth() === month &&
                           taskDate.getDate() === day;
                });

                if (dayTasks.length > 0) {
                    setSelectedDayEvents({ date: clickedDate, tasks: dayTasks });
                }
            };

            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                const days = [];
                const today = new Date();

                // æ·»åŠ ä¸Šä¸ªæœˆçš„å°¾éƒ¨æ—¥æœŸ
                const prevMonth = new Date(year, month - 1, 0);
                for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                    const day = prevMonth.getDate() - i;
                    days.push(
                        <div key={`prev-${day}`} className="calendar-day other-month">
                            <div className="day-number">{day}</div>
                        </div>
                    );
                }

                // æ·»åŠ å½“å‰æœˆçš„æ—¥æœŸ
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDayDate = new Date(year, month, day);
                    const isToday = currentDayDate.toDateString() === today.toDateString();
                    
                    const dayTasks = tasks.filter(task => {
                        if (!task.dueDate) return false;
                        const taskDate = new Date(task.dueDate);
                        return taskDate.getFullYear() === year &&
                               taskDate.getMonth() === month &&
                               taskDate.getDate() === day;
                    });

                    days.push(
                        <div 
                            key={day} 
                            className={`calendar-day ${isToday ? 'today' : ''}`}
                            onClick={() => handleDayClick(year, month, day)}
                        >
                            <div className="day-number">{day}</div>
                            {dayTasks.map(task => (
                                <div 
                                    key={task.id} 
                                    className={`event ${task.category} ${task.completed ? 'completed' : ''}`}
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        setSelectedTask(task);
                                    }}
                                    title={`${task.startTime ? task.startTime + ' ' : ''}${task.title}`}
                                >
                                    {task.startTime && <span style={{fontSize: '10px', marginRight: '4px'}}>{task.startTime}</span>}
                                    {task.title}
                                </div>
                            ))}
                        </div>
                    );
                }

                // æ·»åŠ ä¸‹ä¸ªæœˆçš„å¼€å¤´æ—¥æœŸ
                const remainingCells = 42 - days.length;
                for (let day = 1; day <= remainingCells; day++) {
                    days.push(
                        <div key={`next-${day}`} className="calendar-day other-month">
                            <div className="day-number">{day}</div>
                        </div>
                    );
                }

                return days;
            };

            // è¯·æ±‚é€šçŸ¥æƒé™
            useEffect(() => {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }, []);

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>ğŸ—“ï¸ æ™ºèƒ½æ—¥ç¨‹ç®¡ç†å™¨</h1>
                        <p>è®©AIå¸®ä½ ç®¡ç†æ—¶é—´ï¼Œä»æ­¤ä¸å†é”™è¿‡é‡è¦äº‹é¡¹</p>
                    </div>

                    {message && (
                        <div className={messageType === 'error' ? 'error' : 'success'}>
                            {message}
                        </div>
                    )}

                    <div className="input-section">
                        <div className="input-tabs">
                            <button 
                                className={`tab-button ${activeTab === 'text' ? 'active' : ''}`}
                                onClick={() => setActiveTab('text')}
                            >
                                ğŸ“ æ–‡å­—è¾“å…¥
                            </button>
                            <button 
                                className={`tab-button ${activeTab === 'image' ? 'active' : ''}`}
                                onClick={() => setActiveTab('image')}
                            >
                                ğŸ“· å›¾ç‰‡è¯†åˆ«
                            </button>
                        </div>

                        <div className="input-area">
                            {activeTab === 'text' ? (
                                <>
                                    <textarea 
                                        className="text-input"
                                        value={inputText}
                                        onChange={(e) => setInputText(e.target.value)}
                                        placeholder="æ™ºèƒ½è§£æç¤ºä¾‹ï¼š&#10;â€¢ 8.14ä¸Šåˆ9ç‚¹å¼€ä¼š&#10;â€¢ æ˜å¤©ä¸‹åˆ2ç‚¹åˆ°4ç‚¹å­¦ä¹ &#10;â€¢ ä¸‹å‘¨ä¸‰å‰äº¤ä½œä¸š&#10;â€¢ 3æœˆ15æ—¥æŠ•é€’ç®€å† https://careers.tencent.com/xxx"
                                        disabled={loading}
                                    />
                                    <button 
                                        className="submit-btn" 
                                        onClick={handleTextSubmit}
                                        disabled={loading || !inputText.trim()}
                                    >
                                        {loading ? 'â³ å¤„ç†ä¸­...' : 'âœ¨ æ™ºèƒ½è§£æå¹¶æ·»åŠ '}
                                    </button>
                                </>
                            ) : (
                                <div 
                                    className="file-input-area"
                                    onDrop={handleDrop}
                                    onDragOver={handleDragOver}
                                    onClick={() => document.getElementById('file-input').click()}
                                >
                                    <input 
                                        id="file-input"
                                        type="file" 
                                        accept="image/*"
                                        style={{display: 'none'}}
                                        onChange={(e) => {
                                            if (e.target.files[0]) {
                                                handleImageUpload(e.target.files[0]);
                                            }
                                        }}
                                    />
                                    {loading ? (
                                        <div className="loading">
                                            <div>ğŸ”„ æ­£åœ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—...</div>
                                            <div>è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</div>
                                        </div>
                                    ) : (
                                        <>
                                            <div style={{fontSize: '3rem', marginBottom: '10px'}}>ğŸ“·</div>
                                            <div>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
                                            <div style={{fontSize: '14px', color: '#666', marginTop: '10px'}}>
                                                æ”¯æŒè¯¾ç¨‹è¡¨ã€ä½œä¸šæˆªå›¾ã€æ‰‹å†™ç¬”è®°ç­‰
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="calendar-section">
                        <div className="calendar-header">
                            <button className="nav-btn" onClick={() => navigateMonth(-1)}>â€¹</button>
                            <h2>{currentDate.getFullYear()}å¹´ {currentDate.getMonth() + 1}æœˆ</h2>
                            <button className="nav-btn" onClick={() => navigateMonth(1)}>â€º</button>
                        </div>
                        
                        <div className="calendar-grid">
                            {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(day => (
                                <div key={day} style={{padding: '10px', textAlign: 'center', background: '#f0f0f0', fontWeight: 'bold'}}>
                                    {day}
                                </div>
                            ))}
                            {renderCalendar()}
                        </div>
                    </div>

                    {/* ä»»åŠ¡è¯¦æƒ…å¼¹çª— */}
                    {selectedTask && (
                        <div className="modal" onClick={() => setSelectedTask(null)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>ğŸ“‹ ä»»åŠ¡è¯¦æƒ…</h3>
                                    <button className="close-btn" onClick={() => setSelectedTask(null)}>Ã—</button>
                                </div>
                                
                                <div className="event-details">
                                    <div className="field">
                                        <label>ä»»åŠ¡æ ‡é¢˜</label>
                                        <input 
                                            type="text" 
                                            value={selectedTask.title}
                                            onChange={(e) => setSelectedTask({...selectedTask, title: e.target.value})}
                                        />
                                    </div>

                                    <div className="field">
                                        <label>åˆ†ç±»</label>
                                        <select 
                                            value={selectedTask.category}
                                            onChange={(e) => setSelectedTask({...selectedTask, category: e.target.value})}
                                        >
                                            <option value="study">ğŸ“š å­¦ä¹ </option>
                                            <option value="work">ğŸ’¼ å·¥ä½œ</option>
                                            <option value="personal">ğŸ  ç”Ÿæ´»</option>
                                            <option value="other">ğŸ“ å…¶ä»–</option>
                                        </select>
                                    </div>

                                    <div className="field">
                                        <label>æ—¥æœŸ</label>
                                        <input 
                                            type="date" 
                                            value={selectedTask.dueDate ? selectedTask.dueDate.toISOString().split('T')[0] : ''}
                                            onChange={(e) => setSelectedTask({
                                                ...selectedTask, 
                                                dueDate: e.target.value ? new Date(e.target.value) : null
                                            })}
                                        />
                                    </div>

                                    <div className="field">
                                        <label>æ—¶é—´</label>
                                        <div className="time-inputs">
                                            <div>
                                                <label style={{fontSize: '12px', color: '#888'}}>å¼€å§‹æ—¶é—´</label>
                                                <input 
                                                    type="time" 
                                                    value={selectedTask.startTime || ''}
                                                    onChange={(e) => setSelectedTask({...selectedTask, startTime: e.target.value})}
                                                />
                                            </div>
                                            <div>
                                                <label style={{fontSize: '12px', color: '#888'}}>ç»“æŸæ—¶é—´</label>
                                                <input 
                                                    type="time" 
                                                    value={selectedTask.endTime || ''}
                                                    onChange={(e) => setSelectedTask({...selectedTask, endTime: e.target.value})}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="field">
                                        <label>è¯¦ç»†æè¿°</label>
                                        <textarea 
                                            value={selectedTask.details}
                                            onChange={(e) => setSelectedTask({...selectedTask, details: e.target.value})}
                                            placeholder="æ·»åŠ æ›´å¤šè¯¦ç»†ä¿¡æ¯..."
                                        />
                                    </div>
                                    
                                    {selectedTask.links && selectedTask.links.length > 0 && (
                                        <div className="links">
                                            <p><strong>ğŸ”— ç›¸å…³é“¾æ¥ï¼š</strong></p>
                                            {selectedTask.links.map((link, index) => (
                                                <a key={index} href={link} target="_blank" rel="noopener noreferrer">
                                                    {link}
                                                </a>
                                            ))}
                                        </div>
                                    )}
                                    
                                    <div className="button-group">
                                        <button 
                                            className={`btn ${selectedTask.completed ? 'btn-success' : 'btn-primary'}`}
                                            onClick={() => {
                                                toggleTaskComplete(selectedTask.id);
                                                setSelectedTask(null);
                                            }}
                                        >
                                            {selectedTask.completed ? 'âœ… å·²å®Œæˆ' : 'âœ“ æ ‡è®°å®Œæˆ'}
                                        </button>
                                        <button 
                                            className="btn btn-primary"
                                            onClick={() => {
                                                updateTask(selectedTask.id, selectedTask);
                                                setSelectedTask(null);
                                            }}
                                        >
                                            ğŸ’¾ ä¿å­˜ä¿®æ”¹
                                        </button>
                                        <button 
                                            className="btn btn-danger"
                                            onClick={() => deleteTask(selectedTask.id)}
                                        >
                                            ğŸ—‘ï¸ åˆ é™¤
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* å•æ—¥äº‹ä»¶å±•å¼€å¼¹çª— */}
                    {selectedDayEvents && (
                        <div className="modal day-events-modal" onClick={() => setSelectedDayEvents(null)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>ğŸ“… {selectedDayEvents.date.getMonth() + 1}æœˆ{selectedDayEvents.date.getDate()}æ—¥çš„æ—¥ç¨‹</h3>
                                    <button className="close-btn" onClick={() => setSelectedDayEvents(null)}>Ã—</button>
                                </div>
                                
                                <div className="day-events-list">
                                    {selectedDayEvents.tasks
                                        .sort((a, b) => (a.startTime || '00:00').localeCompare(b.startTime || '00:00'))
                                        .map(task => (
                                        <div 
                                            key={task.id} 
                                            className={`day-event-item ${task.completed ? 'completed' : ''}`}
                                            onClick={() => {
                                                setSelectedDayEvents(null);
                                                setSelectedTask(task);
                                            }}
                                        >
                                            <div className="day-event-time">
                                                {task.startTime && task.endTime 
                                                    ? `${task.startTime} - ${task.endTime}`
                                                    : task.startTime 
                                                        ? `${task.startTime}`
                                                        : 'å…¨å¤©'
                                                }
                                            </div>
                                            <div className="day-event-title">{task.title}</div>
                                            <div className={`day-event-category ${task.category}`}>
                                                {task.category === 'study' ? 'ğŸ“š å­¦ä¹ ' :
                                                 task.category === 'work' ? 'ğŸ’¼ å·¥ä½œ' :
                                                 task.category === 'personal' ? 'ğŸ  ç”Ÿæ´»' : 'ğŸ“ å…¶ä»–'}
                                            </div>
                                            {task.details && (
                                                <div style={{fontSize: '12px', color: '#666', marginTop: '4px'}}>
                                                    {task.details.length > 50 ? task.details.substring(0, 50) + '...' : task.details}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>